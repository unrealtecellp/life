{% extends "links.html" %}

{% block title %}
Progress Report Admin
{% endblock title %}

{% block styles %}
{{ super() }}


<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">


<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">

<style>
    /* Additional styles specific to this page */
    .metric-card {
        margin-bottom: 20px;
    }
</style>

<style>
    /* home_insert.css */

    #audioTable {
        width: 100%;
        margin-top: 20px; /* Adjust as needed */
        /* Add more specific styles as required */
    }

    #dropdownSection {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 20px;
    }

    #dropdownSection h1 {
        margin: 0;
        font-size: 1.5em;
    }

    #dropdownSection select {
        padding: 10px;
        font-size: 1em;
        width: 100%;
        max-width: 400px;
        margin-bottom: 10px;
    }

    #secondaryDropdown {
        padding: 10px;
        font-size: 1em;
        width: 100%;
        max-width: 400px;
    }

    .hidden {
        display: none;
    }

    /* Add more specific styles as required */

</style>

{% endblock %}

{% block app_content %}

<div class="container-fluid">
    <div class="row">
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <!-- <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">
                            <span data-feather="home"></span>
                            Dashboard
                        </a>
                    </li> -->

                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#" onclick="showDashboard()">
                            <span data-feather="home"></span>
                            Dashboard
                        </a>
                    </li>

                    
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showAllProjects()">
                            <span data-feather="file"></span>
                            All projects of a user
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSpecificProject()">
                            <span data-feather="users"></span>
                            Any specific project of the user
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="shopping-cart"></span>
                            Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="bar-chart-2"></span>
                            Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="layers"></span>
                            Integrations
                        </a>
                    </li>
                </ul>

              
                </ul>
            </div>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Dashboard</h1>
                <!-- <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                        <span data-feather="calendar"></span>
                        This week
                    </button>
                </div> -->
            </div>

            {% if activeprojectname is defined %}
            <h4>
                Project Name: {{ activeprojectname }}
            </h4>
            <br>
            <br>
            {% endif %}

            <table id="audioTable" class="display hidden">
                <br>
                <thead>
                    <tr>
                        <th>Created by</th>
                        <th>Speaker ID</th>
                        <th>Assigned to</th>
                        <th>Time and date</th>
                        <th>Duration</th>
                        <th>Total no. of files</th>
                        <th>Completed files</th>
                        <th>Remaining files</th>
                    </tr>
                </thead>
                <tbody>
                    {% for progress_report in progress_reports %}
                    <tr>
                        <td>{{ progress_report['Created by'] }}</td>
                        <td>{{ progress_report['Speaker ID'] }}</td>
                        <td>{{ ', '.join(progress_report['Assigned to']) }}</td>
                        <td>{{ progress_report['Time and date'] }}</td>
                        <td>{{ progress_report['Duration'] }}</td>
                        <td>{{ progress_report['Total no. of files'] }}</td>
                        <td>{{ progress_report['Completed files'] }}</td>
                        <td>{{ progress_report['Remaining files'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div id="secondaryDropdown">
                <!-- Buttons for 'All projects of a user' -->
                <div id="allProjectsButtons" class="hidden">
                    <button class="btn btn-primary" onclick="showCumulativeResults()">Cumulative Results</button>
                    <button class="btn btn-primary" onclick="showIndividualProjectResults()">Individual Project Results</button>
                </div>

                <!-- Buttons for 'Any specific project of the user' -->
                <div id="specificProjectButtons" class="hidden">
                    <button class="btn btn-primary" onclick="showFileWiseResults()">File-wise</button>
                    <button class="btn btn-primary" onclick="showUserWiseResults()">User-wise</button>
                </div>

                <br>
                <br>
                <br>

                <!-- Cumulative Results Section -->
                <div id="cumulativeResults" class="hidden">
                    <h2>Cumulative Results</h2>
                    <ul>
                        <li>Total number of projects (by project type): <!-- Value here --></li>
                        <li>Total space taken: <!-- Value here --></li>
                        <li>Avg space per project: <!-- Value here --></li>
                        <li>Avg number of documents per project: <!-- Value here --></li>
                        <li>Total Remaining Space (as per allocation): <!-- Value here --></li>
                        
                    </ul>


                    <div class="row">
                        <!-- Total Projects -->
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Total Projects</h5>
                                    <p class="card-text">{{ all_projects | length }}</p>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Data Size -->
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Data Size </h5>
                                    <p class="card-text">{{ data_size_value }} {{ data_size_unit }}</p>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Storage Size -->
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Storage Size</h5>
                                    <p class="card-text">{{ storage_size_value }} {{ storage_size_unit }}</p>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Index Size -->
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Index Size</h5>
                                    <p class="card-text">{{ index_size_value }} {{ index_size_unit }}</p>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Number of Objects -->
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Number of Objects</h5>
                                    <p class="card-text">{{ num_objects }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                                        <!-- End Cards section -->
                </div>
            

                <!--Individual Project Results Section -->
                <div id="individualProjectResults" class="hidden">
                    <h2>Individual Project Results</h2>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Name of the project</th>
                                <th>Project type</th>
                                <th>Total number of MongoDB documents</th>
                                <th>Total space taken</th>
                                <th>Total space per entry</th>
                                <th>Owner</th>
                                <th>Access Mode</th>
                                <th>Project Shared By</th>
                                <th>Project Shared with and access mode</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for progress_report in progress_reports %}
                            <tr>
                                <td>{{ progress_report['Speaker ID'] }}</td>
                                <td>{{ progress_report['Time and date'] }}</td>
                                <td>{{ progress_report['Duration'] }}</td>
                                <td>{{ progress_report['Total no. of files'] }}</td>
                                <td>{{ progress_report['Completed files'] }}</td>
                                <td>{{ progress_report['Created by'] }}</td>
                                <td>{{ progress_report['Remaining files'] }}</td>
                                <td></td>
                                <td>{{ ', '.join(progress_report['Assigned to']) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- File-wise Results Section -->
                <div id="fileWiseResults" class="hidden">
                    <h2>File-wise Results</h2>
                    <button class="btn btn-primary">Graphical representation may be shown using data for each boundary and each speaker, wherever applicable</button>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>All Speaker ID(s)</th>
                                <th>Created by</th>
                                <th>Shared with</th>
                                <th>Time and date of assignment</th>
                                <th>Total Duration of the file</th>
                                <th>Number of boundaries/sentences</th>
                                <th>Total Duration of boundaries</th>
                                <th>Total Duration of unmarked portion</th>
                                <th>Total Boundaries with all transcriptions</th>
                                <th>Total Boundaries with no transcription</th>
                                <th>Total Boundaries with partial transcription</th>
                                <th>Scripts with transcriptions in all boundaries</th>
                                <th>Scripts with no transcription in all boundaries</th>
                                <th>Scripts with transcription in some boundaries</th>
                                <th>Total number of words</th>
                                <th>Total number of characters</th>
                                <th>Number of speakers in the file</th>
                                <th>Total Duration of each speaker</th>
                                <th>Details per speaker</th>
                                <th>Translation/Gloss/Annotation details</th>
                                <th>Completed files</th>
                                <th>Remaining files</th>
                                <th>First update date and time</th>
                                <th>Last update date and time</th>
                                <th>Total time</th>
                                <th>Total work time</th>
                                <th>Avg work time per boundary</th>
                                <th>Descriptive Statistics</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populate this section dynamically -->
                            {% for file in files %}
                            <tr>
                                <td>{{ file.speaker_ids }}</td>
                                <td>{{ file.created_by }}</td>
                                <td>
                                    {% for user in file.shared_with %}
                                    <a href="#" onclick="showUserDetails('{{ user.username }}')">{{ user.username }}</a>{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </td>
                                <td>{{ file.assignment_time }}</td>
                                <td>{{ file.total_duration }}</td>
                                <td>{{ file.boundaries_count }}</td>
                                <td>{{ file.boundaries_duration }}</td>
                                <td>{{ file.unmarked_duration }}</td>
                                <td>{{ file.full_transcriptions }}</td>
                                <td>{{ file.no_transcriptions }}</td>
                                <td>{{ file.partial_transcriptions }}</td>
                                <td>{{ file.full_transcription_scripts }}</td>
                                <td>{{ file.no_transcription_scripts }}</td>
                                <td>{{ file.partial_transcription_scripts }}</td>
                                <td>{{ file.word_count }}</td>
                                <td>{{ file.character_count }}</td>
                                <td>{{ file.speaker_count }}</td>
                                <td>{{ file.speaker_durations }}</td>
                                <td>{{ file.speaker_details }}</td>
                                <td>{{ file.translation_gloss_annotation_details }}</td>
                                <td>{{ file.completed_files }}</td>
                                <td>{{ file.remaining_files }}</td>
                                <td>{{ file.first_update_time }}</td>
                                <td>{{ file.last_update_time }}</td>
                                <td>{{ file.total_time }}</td>
                                <td>{{ file.total_work_time }}</td>
                                <td>{{ file.avg_work_time_per_boundary }}</td>
                                <td>{{ file.descriptive_statistics }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- User-wise Results Section -->
                <div id="userWiseResults" class="hidden">
                    <h2>User-wise Results</h2>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Total no. of speakers shared</th>
                                <th>Total no. of files shared</th>
                                <th>List of files</th>
                                <th>Total duration of all files shared</th>
                                <th>Total files completed</th>
                                <th>Total remaining files</th>
                                <th>Total number of boundaries/sentences made by the user</th>
                                <th>Points details</th>
                                <th>Average work details</th>
                                <th>Total work time</th>
                                <th>Avg work time per day, per hour</th>
                                <th>Rate of transcription</th>
                                <th>Rate of translation, glossing, etc.</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populate this section dynamically -->
                            {% for user in users %}
                            <tr>
                                <td>{{ user.total_speakers_shared }}</td>
                                <td>{{ user.total_files_shared }}</td>
                                <td>
                                    {% for file in user.files %}
                                    <a href="#" onclick="showFileDetails('{{ file.id }}')">{{ file.name }}</a>{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </td>
                                <td>{{ user.total_duration_files_shared }}</td>
                                <td>{{ user.total_files_completed }}</td>
                                <td>{{ user.total_remaining_files }}</td>
                                <td>{{ user.total_boundaries_sentences }}</td>
                                <td>{{ user.points_details }}</td>
                                <td>{{ user.average_work_details }}</td>
                                <td>{{ user.total_work_time }}</td>
                                <td>{{ user.avg_work_time_per_day_hour }}</td>
                                <td>{{ user.transcription_rate }}</td>
                                <td>{{ user.translation_gloss_rate }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/bullet.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>

<script>
$(document).ready(function() {
    $('#audioTable').DataTable();
});

// Function to toggle the visibility of elements and hide the audioTable
function toggleVisibility(elementId) {
    var element = document.getElementById(elementId);
    if (element.classList.contains('hidden')) {
        element.classList.remove('hidden');
    } else {
        element.classList.add('hidden');
    }
}

// Function to toggle the buttons for 'All projects of a user'
function showAllProjects() {
    toggleVisibility('allProjectsButtons');
    document.getElementById('specificProjectButtons').classList.add('hidden');
    document.getElementById('cumulativeResults').classList.add('hidden');
    document.getElementById('individualProjectResults').classList.add('hidden');
    document.getElementById('fileWiseResults').classList.add('hidden');
    document.getElementById('userWiseResults').classList.add('hidden');
    document.getElementById('audioTable').classList.add('hidden');
}

// Function to toggle the buttons for 'Any specific project of the user'
function showSpecificProject() {
    toggleVisibility('specificProjectButtons');
    document.getElementById('allProjectsButtons').classList.add('hidden');
    document.getElementById('cumulativeResults').classList.add('hidden');
    document.getElementById('individualProjectResults').classList.add('hidden');
    document.getElementById('fileWiseResults').classList.add('hidden');
    document.getElementById('userWiseResults').classList.add('hidden');
    document.getElementById('audioTable').classList.add('hidden');
}

// Function to toggle the Dashboard and hide other sections
function showDashboard() {
    toggleVisibility('audioTable');
    document.getElementById('allProjectsButtons').classList.add('hidden');
    document.getElementById('specificProjectButtons').classList.add('hidden');
    document.getElementById('cumulativeResults').classList.add('hidden');
    document.getElementById('individualProjectResults').classList.add('hidden');
    document.getElementById('fileWiseResults').classList.add('hidden');
    document.getElementById('userWiseResults').classList.add('hidden');
}

// Function to show the Cumulative Results section
function showCumulativeResults() {
    toggleVisibility('cumulativeResults');
    document.getElementById('individualProjectResults').classList.add('hidden');
}

// Function to show the Individual Project Results section
function showIndividualProjectResults() {
    toggleVisibility('individualProjectResults');
    document.getElementById('cumulativeResults').classList.add('hidden');
}

// Function to show the File-wise Results section
function showFileWiseResults() {
    toggleVisibility('fileWiseResults');
    document.getElementById('userWiseResults').classList.add('hidden');
}

// Function to show the User-wise Results section
function showUserWiseResults() {
    toggleVisibility('userWiseResults');
    document.getElementById('fileWiseResults').classList.add('hidden');
}

// Function to show user details (placeholder)
function showUserDetails(username) {
    alert('Showing details for user: ' + username);
}

// Function to show file details (placeholder)
function showFileDetails(fileId) {
    alert('Showing details for file: ' + fileId);
}
</script>


<script>
    $(document).ready(function() {
        $('#audioTable').DataTable();
    });

    function toggleVisibility(elementId) {
        var element = document.getElementById(elementId);
        if (element.classList.contains('hidden')) {
            element.classList.remove('hidden');
        } else {
            element.classList.add('hidden');
        }
    }

    function showAllProjects() {
        toggleVisibility('allProjectsButtons');
        document.getElementById('specificProjectButtons').classList.add('hidden');
        document.getElementById('cumulativeResults').classList.add('hidden');
        document.getElementById('individualProjectResults').classList.add('hidden');
        document.getElementById('fileWiseResults').classList.add('hidden');
        document.getElementById('userWiseResults').classList.add('hidden');
        document.getElementById('audioTable').classList.add('hidden');
    }

    function showSpecificProject() {
        toggleVisibility('specificProjectButtons');
        document.getElementById('allProjectsButtons').classList.add('hidden');
        document.getElementById('cumulativeResults').classList.add('hidden');
        document.getElementById('individualProjectResults').classList.add('hidden');
        document.getElementById('fileWiseResults').classList.add('hidden');
        document.getElementById('userWiseResults').classList.add('hidden');
        document.getElementById('audioTable').classList.add('hidden');
    }

    function showDashboard() {
        toggleVisibility('audioTable');
        document.getElementById('allProjectsButtons').classList.add('hidden');
        document.getElementById('specificProjectButtons').classList.add('hidden');
        document.getElementById('cumulativeResults').classList.add('hidden');
        document.getElementById('individualProjectResults').classList.add('hidden');
        document.getElementById('fileWiseResults').classList.add('hidden');
        document.getElementById('userWiseResults').classList.add('hidden');
    }

    function showCumulativeResults() {
        toggleVisibility('cumulativeResults');
        document.getElementById('individualProjectResults').classList.add('hidden');
    }

    function showIndividualProjectResults() {
        toggleVisibility('individualProjectResults');
        document.getElementById('cumulativeResults').classList.add('hidden');
    }

    function showFileWiseResults() {
        toggleVisibility('fileWiseResults');
        document.getElementById('userWiseResults').classList.add('hidden');
    }

    function showUserWiseResults() {
        toggleVisibility('userWiseResults');
        document.getElementById('fileWiseResults').classList.add('hidden');
    }

    function showUserDetails(username) {
        alert('Showing details for user: ' + username);
    }

    function showFileDetails(fileId) {
        alert('Showing details for file: ' + fileId);
    }

    // Highcharts bullet charts setup
    $(document).ready(function() {
        function createBulletChart(container, title, value, target) {
            Highcharts.chart(container, {
                chart: {
                    type: 'bullet',
                    inverted: true,
                    marginLeft: 135,
                    height: 100
                },
                title: {
                    text: title
                },
                legend: {
                    enabled: false
                },
                yAxis: {
                    gridLineWidth: 0
                },
                plotOptions: {
                    series: {
                        pointPadding: 0.25,
                        borderWidth: 0,
                        color: '#000',
                        targetOptions: {
                            width: '200%'
                        }
                    }
                },
                series: [{
                    data: [{
                        y: value,
                        target: target
                    }]
                }],
                tooltip: {
                    pointFormat: '<b>{point.y}</b> (target: <b>{point.target}</b>)'
                }
            });
        }

        createBulletChart('totalProjectsBullet', 'Total Projects', {{ all_projects | length }}, 100);
        createBulletChart('dataSizeBullet', 'Data Size', {{ data_size }}, 1000);
        createBulletChart('storageSizeBullet', 'Storage Size', {{ storage_size | default(0) }}, 500);
        createBulletChart('indexSizeBullet', 'Index Size', {{ num_objects | default(0) }}, 200);

        // Example bullet chart function
        function createBulletChart(container, title, value, target) {
            Highcharts.chart(container, {
                chart: {
                    type: 'bullet',
                    inverted: true,
                    marginLeft: 135,
                    height: 100
                },
                title: {
                    text: title
                },
                legend: {
                    enabled: false
                },
                yAxis: {
                    gridLineWidth: 0
                },
                plotOptions: {
                    series: {
                        pointPadding: 0.25,
                        borderWidth: 0,
                        color: '#000',
                        targetOptions: {
                            width: '200%'
                        }
                    }
                },
                series: [{
                    data: [{
                        y: value,
                        target: target
                    }]
                }],
                tooltip: {
                    pointFormat: '<b>{point.y}</b> (target: <b>{point.target}</b>)'
                }
            });
        }
    });
</script>


{% endblock %}
