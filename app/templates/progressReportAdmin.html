{% extends "links.html" %}

{% block title %}
Progress Report Admin
{% endblock title %}

{% block styles %}
{{ super() }}



<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">


<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f8f9fa;
        padding-top: 20px;
    }
    .container {
        width: 80%;
        margin: 0 auto;
    }
    h2 {
        text-align: center;
        margin-bottom: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    table th, table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    table th {
        background-color: #f2f2f2;
        font-weight: bold;
    }
    table tr:hover {
        background-color: #f9f9f9;
    }
    .modal-dialog {
        max-width: 1000px; /* Increase the max-width to fit wider content */
    }
    .modal-content {
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .modal-body {
        overflow-y: auto;
    }
    .modal-title {
        font-weight: bold;
    }
    .close {
        font-size: 1.5rem;
        color: #da0707;
    }
    .close:hover {
        color: #333;
        text-decoration: none;
    }
</style>



<style>

    /* Additional styles specific to this page */
    .metric-card {
        margin-bottom: 20px;
        border: 1px solid #ddd; /* Add a border */
        border-radius: 8px; /* Rounded corners */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow for depth */
        transition: box-shadow 0.3s ease-in-out; /* Smooth shadow transition */
    }

    .metric-card:hover {
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* Shadow effect on hover */
    }

    .metric-card .card-body {
        padding: 20px; /* Padding inside the card */
    }

    .metric-card .card-title {
        font-size: 18px; /* Title font size */
        margin-bottom: 10px; /* Space below the title */
    }

    .metric-card .card-text {
        font-size: 16px; /* Text font size */
        color: #555; /* Text color */
    }



    /* Sidebar styles */
    .side-nav-container {
        background-color: rgb(218, 239, 247);
        color: rgb(2, 1, 59);
        padding: 20px;
        height: 50vh;
        position: fixed;
        left: 10;
        width: 250px; /* Adjust sidebar width here */
        z-index: 1; /* Ensure sidebar is above main content */
        overflow-y: auto; /* Enable scrolling if content exceeds sidebar height */
    }

    .side-nav-container a {
        color: rgb(78, 9, 78);
        text-decoration: none;
        display: block;
        padding: 10px 0;
    }

    .side-nav-container a:hover {
        text-decoration: underline;
    }

    .main-content {
        margin-left: 250px; /* Adjust based on sidebar width */
        padding: 20px;
    }

    /* Ensure responsive behavior */
    @media (max-width: 768px) {
        .side-nav-container {
            width: 100%; /* Sidebar takes full width on smaller screens */
            margin-bottom: 10px; /* Add margin below sidebar */
        }

        .main-content {
            margin-left: 0; /* No margin on the left for main content */
        }
    }


</style>




{% endblock %}

{% block app_content %}

<div class="container-fluid">
    <div class="row">
        <nav class="side-nav-container col-md-3 col-lg-2">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <!-- <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">
                            <span data-feather="home"></span>
                            Dashboard
                        </a>
                    </li> -->

                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showDashboard()">
                            <span data-feather="home"></span>
                            Dashboard
                        </a>
                    </li>

                    
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showAllProjects()">
                            <span data-feather="file"></span>
                            All projects of a user
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSpecificProject()">
                            <span data-feather="users"></span>
                            Any specific project of the user
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="bar-chart-2"></span>
                            Reports
                        </a>
                    </li>
                </ul>

              
                </ul>
            </div>
        </nav>

         <main class="main-content col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Dashboard</h1>
            </div>

            {% if activeprojectname is defined %}
            <h4>
                Project Name: {{ activeprojectname }}
            </h4>
            <br>
            <br>
            {% endif %}

              <!-- Table for Project List -->
                <table id="audioTable" class="hidden">
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in project_stats %}
                        <tr>
                            <td>{{ project.projectname }}</td>
                            
                            <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#projectModal{{ loop.index }}">View Details</button></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                 <!-- Modals for Project Details -->
                 {% for project in project_stats %}
                 <div class="modal fade" id="projectModal{{ loop.index }}" tabindex="-1" role="dialog" aria-labelledby="projectModalLabel{{ loop.index }}" aria-hidden="true">
                     <div class="modal-dialog" role="document">
                         <div class="modal-content">
                             <div class="modal-header">
                                 <h5 class="modal-title" id="projectModalLabel{{ loop.index }}">{{ project.projectname }}</h5>
                                 <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                     <span aria-hidden="true">&times;</span>
                                 </button>
                             </div>
                             <div class="modal-body">
                                 <table class="table table-bordered">
                                     <tbody>
                                         <tr><th>Project Owner</th><td>{{ project.projectOwner }}</td></tr>
                                         <tr><th>Shared With</th><td>{{ project.sharedwith }}</td></tr>
                                         <tr><th>Project Derivatives</th><td>{{ project.projectDerivatives }}</td></tr>
                                         <tr><th>About Project</th><td>{{ project.aboutproject }}</td></tr>
                                         <tr><th>Project Type</th><td>{{ project.projectType }}</td></tr>
                                         <tr><th>Speaker IDs</th><td>{{ project.speakerIds }}</td></tr>
                                         <tr><th>Speakers Audio IDs</th><td>{{ project.speakersAudioIds }}</td></tr>
                                         <tr><th>Total Audio IDs</th><td>{{ project.totalAudioIds }}</td></tr>
                                         <tr><th>Speakers Audio IDs Keys</th><td>{{ project.speakersAudioIdsKeys }}</td></tr>
                                     </tbody>
                                 </table>
                             </div>
                             <div class="modal-footer">
                                 <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                             </div>
                         </div>
                     </div>
                 </div>
                 {% endfor %}




                    <!-- Modals for Project Details -->
                    {% for project in project_stats %}
                    <div class="modal fade" id="projectModal{{ loop.index }}" tabindex="-1" role="dialog" aria-labelledby="projectModalLabel{{ loop.index }}" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="projectModalLabel{{ loop.index }}">{{ project.projectname }}</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <table class="table table-bordered">
                                        <tbody>
                                            <tr><th>Project Owner</th><td>{{ project.projectOwner }}</td></tr>
                                            <tr><th>Shared With</th><td>{{ project.sharedwith }}</td></tr>
                                            <tr><th>Project Derivatives</th><td>{{ project.projectDerivatives }}</td></tr>
                                            <tr><th>About Project</th><td>{{ project.aboutproject }}</td></tr>
                                            <tr><th>Project Type</th><td>{{ project.projectType }}</td></tr>
                                            <tr><th>Speaker IDs</th><td>{{ project.speakerIds }}</td></tr>
                                            <tr><th>Speakers Audio IDs</th><td>{{ project.speakersAudioIds }}</td></tr>
                                            <tr><th>Total Audio IDs</th><td>{{ project.totalAudioIds }}</td></tr>
                                            <tr><th>Speakers Audio IDs Keys</th><td>{{ project.speakersAudioIdsKeys }}</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

            <div id="secondaryDropdown">
                <!-- Buttons for 'All projects of a user' -->
                <div id="allProjectsButtons" class="hidden">
                    <button class="btn btn-primary" onclick="showCumulativeResults()">Cumulative Results</button>
                    <button class="btn btn-primary" onclick="showIndividualProjectResults()">Individual Project Results</button>
                </div>

                <!-- Buttons for 'Any specific project of the user' -->
                <div id="specificProjectButtons" class="hidden">
                    <button class="btn btn-primary" onclick="showFileWiseResults()">File-wise</button>
                    <button class="btn btn-primary" onclick="showUserWiseResults()">User-wise</button>
                </div>

                <br>
                <br>
                <br>

                <!-- Cumulative Results Section -->
                <div id="cumulativeResults" class="hidden">
                    <h2>Cumulative Results</h2>
                    <ul>
                        <li>Total number of projects (by project type): {{ all_projects | length }}</li>
                        <li>Total space taken: {{ data_size_value }} {{ data_size_unit }}</li>
                        <li>Avg space per project: <!-- Value here --></li>
                        <li>Avg number of documents per project: <!-- Value here --></li>
                        <li>Total Remaining Space (as per allocation): {{ remaining_space_value }} {{ remaining_space_unit }}</li>
                        
                    </ul>


                    <div class="row">
                        <!-- Total Projects -->
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Total Projects</h5>
                                    <p class="card-text">{{ all_projects | length }}</p>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Data Size -->
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Data Size </h5>
                                    <p class="card-text">{{ data_size_value }} {{ data_size_unit }}</p>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Storage Size -->
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Storage Size</h5>
                                    <p class="card-text">{{ storage_size_value }} {{ storage_size_unit }}</p>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Index Size -->
                        <!-- <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Index Size</h5>
                                    <p class="card-text">{{ index_size_value }} {{ index_size_unit }}</p>
                                </div>
                            </div>
                        </div> -->
                    
                        <!-- Number of Objects -->
                        <!-- <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Number of Objects</h5>
                                    <p class="card-text">{{ num_objects }}</p>
                                </div>
                            </div>
                        </div> -->
                    
                                        
                            <!-- Remaining Space -->
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">Remaining Space</h5>
                                    <p class="card-text">{{ remaining_space_value }} {{ remaining_space_unit }}</p>
                                </div>
                            </div>
                        </div>
                    </div>


                                    
                                    <!-- Collection Statistics Cards -->
                    <!-- <div class="row">
                        {% for collection_name, stats in collection_stats.items() %}
                        <div class="col-md-6">
                            <div class="card metric-card">
                                <div class="card-body">
                                    <h5 class="card-title">{{ collection_name }}</h5>
                                    <p class="card-text">Storage Size: {{ stats["Storage Size"] }}</p>
                                    <p class="card-text">Documents: {{ stats["Documents"] }}</p>
                                    <p class="card-text">Avg. Document Size: {{ stats["Avg. Document Size"] }}</p>
                                    <p class="card-text">Indexes: {{ stats["Indexes"] }}</p>
                                    <p class="card-text">Total Index Size: {{ stats["Total Index Size"] }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>-->
                    </div> 

               <!-- Individual Project Results Section -->
                    <div id="individualProjectResults" class="hidden">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Project Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for project in project_stats %}
                                <tr data-toggle="modal" data-target="#projectModal{{ loop.index }}">
                                    <td>{{ project.projectname }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                   






        <!-- File-wise Results Section -->
        <!-- File-wise Results Section -->
        <!-- File-wise Results Section -->
<!-- File-wise Results Section -->
<div id="fileWiseResults" class="hidden">
    <h2>File-wise Results</h2>
    <!-- <button class="btn btn-primary">Graphical representation may be shown using data for each boundary and each speaker, wherever applicable</button>
    <br><br> -->

    <select id="selectProjects">
        <option value="">--Select Project Name--</option>
        {% for project in project_documents_file_wise.keys() %}
        <option value="{{ project }}">{{ project }}</option>
        {% endfor %}
    </select>
    
    <br><br>

    <select id="selectSpeakers" style="display:none;">
        <!-- Speaker options will be populated dynamically -->
    </select>
    
    <br><br><br>
    <table id="documentsTable">
        <thead>
            <tr>
                <th>Project Owner</th>
                <th>Speaker ID</th>
                <th>File</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- Table rows will be populated dynamically -->
        </tbody>
    </table>
</div>



                <!-- User-wise Results Section -->
                <div id="userWiseResults" class="hidden">
                    <h2>User-wise Results</h2>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Total no. of speakers shared</th>
                                <th>Total no. of files shared</th>
                                <th>List of files</th>
                                <th>Total duration of all files shared</th>
                                <th>Total files completed</th>
                                <th>Total remaining files</th>
                                <th>Total number of boundaries/sentences made by the user</th>
                                <th>Points details</th>
                                <th>Average work details</th>
                                <th>Total work time</th>
                                <th>Avg work time per day, per hour</th>
                                <th>Rate of transcription</th>
                                <th>Rate of translation, glossing, etc.</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populate this section dynamically -->
                            {% for user in users %}
                            <tr>
                                <td>{{ user.total_speakers_shared }}</td>
                                <td>{{ user.total_files_shared }}</td>
                                <td>
                                    {% for file in user.files %}
                                    <a href="#" onclick="showFileDetails('{{ file.id }}')">{{ file.name }}</a>{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </td>
                                <td>{{ user.total_duration_files_shared }}</td>
                                <td>{{ user.total_files_completed }}</td>
                                <td>{{ user.total_remaining_files }}</td>
                                <td>{{ user.total_boundaries_sentences }}</td>
                                <td>{{ user.points_details }}</td>
                                <td>{{ user.average_work_details }}</td>
                                <td>{{ user.total_work_time }}</td>
                                <td>{{ user.avg_work_time_per_day_hour }}</td>
                                <td>{{ user.transcription_rate }}</td>
                                <td>{{ user.translation_gloss_rate }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}





<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/bullet.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>

<script>
    $(document).ready(function() {
        $('#audioTable').DataTable();
    });
    
    // Function to toggle the visibility of elements and hide the audioTable
    function toggleVisibility(elementId) {
        var element = document.getElementById(elementId);
        if (element.classList.contains('hidden')) {
            element.classList.remove('hidden');
        } else {
            element.classList.add('hidden');
        }
    }
    
    // Function to toggle the buttons for 'All projects of a user'
    function showAllProjects() {
        toggleVisibility('allProjectsButtons');
        document.getElementById('specificProjectButtons').classList.add('hidden');
        document.getElementById('cumulativeResults').classList.add('hidden');
        document.getElementById('individualProjectResults').classList.add('hidden');
        document.getElementById('fileWiseResults').classList.add('hidden');
        document.getElementById('userWiseResults').classList.add('hidden');
        document.getElementById('audioTable').classList.add('hidden');
    }
    
    // Function to toggle the buttons for 'Any specific project of the user'
    function showSpecificProject() {
        toggleVisibility('specificProjectButtons');
        document.getElementById('allProjectsButtons').classList.add('hidden');
        document.getElementById('cumulativeResults').classList.add('hidden');
        document.getElementById('individualProjectResults').classList.add('hidden');
        document.getElementById('fileWiseResults').classList.add('hidden');
        document.getElementById('userWiseResults').classList.add('hidden');
        document.getElementById('audioTable').classList.add('hidden');
    }
    
    // Function to toggle the Dashboard and hide other sections
    function showDashboard() {
        toggleVisibility('audioTable');
        document.getElementById('allProjectsButtons').classList.add('hidden');
        document.getElementById('specificProjectButtons').classList.add('hidden');
        document.getElementById('cumulativeResults').classList.add('hidden');
        document.getElementById('individualProjectResults').classList.add('hidden');
        document.getElementById('fileWiseResults').classList.add('hidden');
        document.getElementById('userWiseResults').classList.add('hidden');
    }
    

    // Function to show the Cumulative Results section
    function showCumulativeResults() {
        toggleVisibility('cumulativeResults');
        document.getElementById('individualProjectResults').classList.add('hidden');
    }
    
    // Function to show the Individual Project Results section
    function showIndividualProjectResults() {
        toggleVisibility('audioTable');
        document.getElementById('cumulativeResults').classList.add('hidden');
    }










    
// Function to toggle visibility of File-wise Results section
// Function to toggle visibility of File-wise Results section
// Function to toggle visibility of File-wise Results section
// Function to toggle visibility of File-wise Results section
function showFileWiseResults() {
    $('#fileWiseResults').removeClass('hidden');
    $('#userWiseResults').addClass('hidden');

    // Clear existing table
    var table = $('#documentsTable').DataTable();
    table.clear().draw();

    // Get selected project
    var selectedProject = $('#selectProjects').val();
    if (!selectedProject) {
        $('#selectSpeakers').empty().hide(); // Hide and clear the speaker dropdown
        return;
    }

    // Retrieve project data
    var projectData = {{ project_documents_file_wise|tojson }};
    var projectOwner = projectData[selectedProject]['projectowner'];
    var speakersData = projectData[selectedProject]['speakersAudioIds'];

    // Populate the speaker dropdown
    var speakerOptions = '<option value="">--Select Speaker ID--</option>';
    Object.keys(speakersData).forEach(function(speaker) {
        speakerOptions += '<option value="' + speaker + '">' + speaker + '</option>';
    });
    $('#selectSpeakers').html(speakerOptions).show(); // Show the dropdown

    // Event listener for the speaker dropdown
    $('#selectSpeakers').change(function() {
        var selectedSpeaker = $(this).val();
        if (!selectedSpeaker) return;

        // Clear existing table
        table.clear().draw();

        // Get files for the selected speaker
        var files = speakersData[selectedSpeaker];
        files.forEach(function(file) {
            var newRow = [
                projectOwner,
                selectedSpeaker,
                file,
                '<button class="btn btn-primary">View Details</button>'
            ];
            table.row.add(newRow).draw();
        });
    });
}

// Initialize DataTables
$(document).ready(function() {
    $('#documentsTable').DataTable({
        pageLength: 5,
        lengthMenu: [5, 10, 30, 50]
    });

    // Event listener for the project selection dropdown
    $('#selectProjects').change(function() {
        showFileWiseResults();
    });

    // Initially hide userWiseResults and speaker dropdown
    $('#userWiseResults').addClass('hidden');
    $('#selectSpeakers').hide();
});

// Function to toggle visibility of elements by class
function toggleVisibility(id) {
    $('#' + id).toggleClass('hidden');
}















    
    
    // Function to show the User-wise Results section
    function showUserWiseResults() {
        toggleVisibility('userWiseResults');
        document.getElementById('fileWiseResults').classList.add('hidden');
    }
    
    // Function to show user details (placeholder)
    function showUserDetails(username) {
        alert('Showing details for user: ' + username);
    }
    
    // Function to show file details (placeholder)
    function showFileDetails(fileId) {
        alert('Showing details for file: ' + fileId);
    }
    </script>
    
    <script>
        $(document).ready(function() {
            // Initialize DataTables for projectTable
            $('#projectTable').DataTable();
        });
    </script>





    
{% endblock %}
